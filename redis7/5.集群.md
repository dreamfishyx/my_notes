##### 主从复制

1. 主从复制: master 以写为主，slave 以读为主,当 master 数据变化的时候，自动将新的数据异步同步到其它 slave 数据库。<br><img src="./assets/image-20250228214118235.png" alt="image-20250228214118235" style="zoom:50%;" />

2. 作用:读写分离、容灾恢复、数据备份、水平拓容支撑高并发

3. 配置主从复制:<font color=red>配从库不配主库！！！</font>

   1. master 如果配置了 `requirepass` 参数，需要密码登陆。那么 slave 就要配置 `masterauth`来设置校验密码，否则的话 master 会拒绝 slave 的访问请求。
   2. salve 的 redis.conf 配置文件添加`replicaof <master_ip> <master_port>`，配置主库 ip 和端口。
   3. `info replication`可以查看复制节点的主从关系和配置信息。
   4. `slaveof <master_ip> <master_port>`无需修改配置文件，使用命令动态设置主库信息。
   5. `slaveof no one`是当前 salve 断开与 master 同步，并转为主数据库。

4. 前置条件，配置文件修改:

   1. `daemonize yes`守护进程形式启动(后台启动)。
   2. 注释`bind 127.0.0.1`运行其他 ip 远程连接。
   3. `protected-mode no` 关闭保护模式。
   4. 指定运行端口`port <port>`。
   5. 指定当前工作目录`dir <dir>`。
   6. 指定 pid 文件名字`pidfile <file_name>`一般不用改，知道这个配置就行。
   7. 指定日志文件名字`logfile <name>`，生成日志文件存放在`dir <dir>`配置的目录下。
   8. 指定日志级别`loglevel <level>`,一般就是 notic，知道就行。
   9. 指定数据库密码`requirepass <passwd>`(一般无论主从都是设置同一个密码)。
   10. 指定 RDB 文件名称`dbfilename <name>`。
   11. 指定 aof 文件目录`appenddirname <dir>`和文件名称`appendfilename <name>`。
   12. <font color=red>从机必须指定访问主机的通行密码 `masterauth <passwd>`。</font>

5. 为了方便演示操作，我们在 docker 中演示:

   | 容器名  | 角色   | ip:port | 配置文件       |
   | ------- | ------ | ------- | -------------- |
   | redis_1 | master | 6379    | redis6379.conf |
   | redis_2 | salve  | 6380    | redis6380.conf |
   | redis_2 | salve  | 6381    | redis6381.conf |

   ```bash
   # 确保主从容器在同一网络下，避免 IP 动态变化问题
   docker network create redis-net
   
   # redis_1
   docker run \
   -v /redis/conf/redis6379.conf:/etc/redis/redis.conf  \
   -v /redis/data6379:/data \
   --network redis-net \ 
   --restart=always \
   -dp 6379:6379 \
   --name redis_1 \
   redis:7.4.2 \
   redis-server /etc/redis/redis.conf
   
   
   # redis_2
   docker run \
   -v /redis/conf/redis6380.conf:/etc/redis/redis.conf  \
   -v /redis/data6380:/data \
   --network redis-net \ 
   --restart=always \
   -dp 6380:6379 \
   --name redis_2 \
   redis:7.4.2 \
   redis-server /etc/redis/redis.conf
   
   # redis_3
   docker run \
   -v /redis/conf/redis6381.conf:/etc/redis/redis.conf  \
   -v /redis/data6381:/data \
   --network redis-net \ 
   --restart=always \
   -dp 6381:6379 \
   --name redis_3 \
   redis:7.4.2 \
   redis-server /etc/redis/redis.conf
   ```

   > 使用 docker 的 -d 参数启动 redis 容器时，配置文件需要关闭守护进程形式(后台)形式启动`daemonize no`，不然二者会冲突！！！至于`dir /data`配置前面已经提过，默认的`dir ./`是等效的。

6. 具体操作:

   1. 永久型:
   2. 动态型:



```
redis-server --port 6380 --slaveof <master-ip> <master-port>
```

```
--requirepass "yourpassword"
```





##### 哨兵



##### 集群



##### docker搭建集群